<html>

<head>
    <title>shooter</title>
    <style>
        .player {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: brown;
        }

        .currentPlayer {
            background-color: blue;
        }

        .bullet {
            position: absolute;
            width: 2px;
            height: 2px;
            background-color: black;
        }
    </style>
</head>


<body>



    <script>
        // Create WebSocket connection.
        var wsUrl = new URL('', window.location.href);
        wsUrl.protocol = wsUrl.protocol.replace('http', 'ws');
        wsUrl.port = 9206;
        const socket = new WebSocket(wsUrl.href);
        let playerId;
        function updateGameState(gameState) {
            for (const player of gameState.players) {
                let playerDiv = document.getElementById(player.id);
                if (!playerDiv) {
                    playerDiv = document.createElement("div");
                    playerDiv.id = player.id;
                    playerDiv.classList.add("player");
                    if (player.id == playerId) {
                        playerDiv.classList.add("currentPlayer");
                    }
                    document.body.append(playerDiv);
                }
                playerDiv.style.left = `${player.x}px`;
                playerDiv.style.top = `${player.y}px`;
            }
        }

        // Listen for messages
        socket.addEventListener("message", (event) => {
            console.log("Message from server ", event.data);
            const message = JSON.parse(event.data);
            switch (message.type) {
                case "gameState":
                    updateGameState(message);
                    break;
                case "currentPlayerId":
                    playerId = message.playerId;
                    break;
                default:
                    break;
            }
        });
        function sendMoveAction(moveDirection) {
            sendAction({
                action: "move",
                moveDirection: moveDirection
            });
        }
        function sendAction(action) {
            socket.send(JSON.stringify(action));

        }
        document.onkeydown = function (ev) {
            if (ev.key == "ArrowDown" || ev.key == "s") {
                sendMoveAction("down");
            }
            if (ev.key == "ArrowUp" || ev.key == "w") {
                sendMoveAction("up");
            }
            if (ev.key == "ArrowLeft" || ev.key == "a") {
                sendMoveAction("left");
            }
            if (ev.key == "ArrowRight" || ev.key == "d") {
                sendMoveAction("right");
            }
            if (ev.code == "Space") {
                sendAction({
                    action: "shoot"
                });
            }

        }
    </script>
</body>

</html>